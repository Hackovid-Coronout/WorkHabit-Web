<html>
<head>
    <title>WorkHabit</title>
    <meta charset="UTF-8">
    <meta name="description" content="Aplicació amb consells per teletreballar més saludablement">
    <meta name="author" content="Hackovid-052-coronout">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="57x57" href="./img/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./img/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./img/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./img/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./img/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./img/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./img/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./img/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./img/apple-icon-180x180.png">
    <link id="icon16" rel="icon" type="image/png" sizes="16x16" href="./img/favicon-16x16.png">
    <link id="icon32" rel="icon" type="image/png" sizes="32x32" href="./img/favicon-32x32.png">
    <link id="icon96" rel="icon" type="image/png" sizes="96x96" href="./img/favicon-96x96.png">
    <link id="icon192" rel="icon" type="image/png" sizes="192x192"  href="./img/android-icon-192x192.png">
    <link rel="shortcut icon" href="./favicon.ico">
    <link rel="manifest" href="./manifest.json">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-TileImage" content="./img/ms-icon-144x144.png">
    <meta name="theme-color" content="#000000">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/ca.js" integrity="sha256-NPnuFvS1oYkm3cZVq776l59xkaYkS+8ZRfK7uwbd70g=" crossorigin="anonymous"></script>

    <script src="./js/bootstrap-material-datetimepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-datetimepicker/2.7.1/css/bootstrap-material-datetimepicker.min.css" integrity="sha256-h472ZYEQbdqAvtB9tQqzpmBApho+fZfF8MmPwTHaqas=" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js" integrity="sha256-tSRROoGfGWTveRpDHFiWVz+UXt+xKNe90wwGn25lpw8=" crossorigin="anonymous"></script>

    <script src="./js/utils.js"></script>
    <script src="./js/bd.js"></script>
    <script src="./js/msg.js"></script>
    <script src="./js/notification.js"></script>

    <style>
        .btn-secondary:not(:disabled):not(.disabled).active, .btn-secondary:not(:disabled):not(.disabled):active, .show>.btn-secondary.dropdown-toggle
        {
            background-color: #66CC00;
            border-color: #66CC00;
        }
        input.bg-danger {
            color: #fff !important;
        }
    </style>
</head>
<body>
<header>
    <div class="collapse bg-dark" id="navbarHeader">
        <div class="container">
            <div class="row">
                <div class="col-sm-8 col-md-7 py-4">
                    <h4 class="text-white">WorkHabit</h4>
                    <p class="text-muted">WorkHabit és una aplicació que proporciona consells perquè les persones que fem Teletreball tinguem una millor experiència i no perdem hàbits saludables. Des de pauses per descansar fins a pauses per fer estiraments seran els missatges que et proporcionarà l'aplicació de forma intel·ligent acontant el teu horari laboral. Gaudeix del teletreball amb WorkHabit.</p>
                </div>
                <div class="col-sm-4 offset-md-1 py-4">
                    <h4 class="text-white">Contacta'ns</h4>
                    <ul class="list-unstyled">
                        <li><a href="mailto:suport@workhabit.cat" class="text-white">Suport</a></li>
                        <li><a href="#" class="text-white">Facebook</a></li>
                        <li><a href="#" class="text-white">Twitter</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container d-flex justify-content-between">
            <a href="#" class="navbar-brand d-flex align-items-center">
                <img src="./img/logo-negatiu-workhabit.png" height="30"/>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</header>

<main role="main">

    <section class="jumbotron text-center">
        <div class="container">
            <h1>Treballa saludablement</h1>
            <p class="lead text-muted">
                Aplicació amb consells per teletreballar més saludablement
            </p>
            <p id="PresentacioSenseConfiguracio">
                Deixa que t'ajudem a concil·liar millor la feina i el teletreball.<br/>
                T'avisem sempre que hagis de fer una parada per descansar i quan has de començar o acabar de treballar.<br/>
                <br/>
                Accedeix a la configuració per adaptar els teus avisos.
            </p>
            <p id="PresentacioAmbConfiguracio" style="display: none;">
                Deixa que t'ajudem a concil·liar millor la feina i el teletreball.<br/><br/>
                Ara que ja ho tens configurat, t'avisarem cada cop que hagis de fer una parada/pausa mitjançant avisos<br/>que podràs veure a l'aplicació.
                Gràcies per utilitzar l'aplicació.
            </p>
            <p>
                <a href="#" class="btn btn-primary my-2" data-toggle="modal" data-target="#configModal">Configuració</a>
            </p>
        </div>
    </section>

    <div class="album py-5 bg-light">
        <div class="container">

            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-4 shadow-sm">
                        <img src="./img/people-exercise-fit-fitness.jpg" style="width:100%;" alt="Fes exercici"/>
                        <div class="card-body">
                            <p class="card-text">Fes exercici</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
                                    <button id="btnExercici" type="button" class="btn btn-sm btn-outline-secondary">Veure</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-4 shadow-sm">
                        <img src="./img/phone-call.jpg" style="width:100%;" alt="Truca a família i amics"/>
                        <div class="card-body">
                            <p class="card-text">Truca a família i amics</p>
                            <div class="d-flex justify-content-between align-items-center">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-4 shadow-sm">
                        <img src="./img/work-productivity.jpg" style="width:100%;" alt="Truca a família i amics"/>
                        <div class="card-body">
                            <p class="card-text">Concentra't, WorkHabit t'avisa quan has de parar.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-outline-secondary">Configura</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Config -->
    <div class="modal fade" id="configModal" tabindex="-1" data-backdrop="static" role="dialog" aria-labelledby="configModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document" style="max-width: 1024px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="configModalLabel">Configuració</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!--<div class="row">
                        <div class="col-sm-2 col-md-2">
                            <label for="dataNaixement">Data naixement</label>
                        </div>
                        <div class="col-sm-4 col-md-4">
                            <input id="dataNaixement" type="text">
                        </div>
                    </div>-->
                    <h6>Horari laboral:</h6>
                    <div class="row"> <!-- dilluns -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="1" id="dia1" type="checkbox" checked> Dilluns
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="1" hora="1" id="dia1-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="1" hora="2" id="dia1-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="1" hora="3" id="dia1-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="1" hora="4" id="dia1-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- dimarts -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="2" id="dia2" type="checkbox" checked> Dimarts
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="2" hora="1" id="dia2-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="2" hora="2" id="dia2-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="2" hora="3" id="dia2-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="2" hora="4" id="dia2-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- dimecres -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="3" id="dia3" type="checkbox" checked> Dimecres
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="3" hora="1" id="dia3-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="3" hora="2" id="dia3-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="3" hora="3" id="dia3-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="3" hora="4" id="dia3-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- dijous -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="4" id="dia4" type="checkbox" checked> Dijous
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="4" hora="1" id="dia4-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="4" hora="2" id="dia4-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="4" hora="3" id="dia4-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="4" hora="4" id="dia4-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- divendres -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="5" id="dia5" type="checkbox" checked> Divendres
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="5" hora="1" id="dia5-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="5" hora="2" id="dia5-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="5" hora="3" id="dia5-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="5" hora="4" id="dia5-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- dissabte -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="6" id="dia6" type="checkbox"> Dissabte
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="6" hora="1" id="dia6-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="6" hora="2" id="dia6-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="6" hora="3" id="dia6-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="6" hora="4" id="dia6-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row"> <!-- diumenge -->
                        <div class="col-sm-2 col-md-2">
                            <div class="btn-group-toggle col-sm-12 col-md-12" data-toggle="buttons">
                                <label class="btn btn-secondary active col-sm-12 col-md-12">
                                    <input dia="7" id="dia7" type="checkbox"> Diumenge
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-10 col-md-10">
                            <div class="row">
                                <div class="col-sm-2 col-md-2">
                                    <input dia="7" hora="1" id="dia7-h1" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="7" hora="2" id="dia7-h2" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">

                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="7" hora="3" id="dia7-h3" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                                <div class="col-sm-1 col-md-1">
                                    <p align="center">-</p>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <input dia="7" hora="4" id="dia7-h4" type="text" class="selectorHora form-control col-sm-12 col-md-12"/>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button id="btnBorraConfig" type="button" class="btn btn-danger pull-left" data-dismiss="modal">Borra configuració</button>
                    <button id="btnTancar" type="button" class="btn btn-secondary" data-dismiss="modal">Tanca</button>
                    <button id="btnGuardarConfig" type="button" class="btn btn-primary">Guarda configuració</button>
                </div>
            </div>
        </div>
    </div>

    <div>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>
                        <strong>Demostració</strong><br/>
                        A continuació, per no haver d'esperar a que els missatges apareguin en funció de l'horari establert, teniu la opció de visualitzar els missatges que us apareixeran.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <button data-message="inici_feina" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Inici feina</button>
                </div>
                <div class="col-md-4">
                    <button data-message="fi_feina" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Fi feina</button>
                </div>
                <div class="col-md-4">
                    <button data-message="social" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Trucada</button>
                </div>
            </div><br/>
            <div class="row">
                <div class="col-md-4">
                    <button data-message="mini-parada" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Parada petita</button>
                </div>
                <div class="col-md-4">
                    <button data-message="parada" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Parada gran</button>
                </div>
                <div class="col-md-4">
                    <button data-message="esport" type="button" class="btnDemo col-md-12 btn btn-sm btn-outline-secondary">Exercici</button>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="text-muted">
    <div class="container">
        <p class="float-right">
            <br/>
        </p>
    </div>
</footer>

<script>
    let bbdd = new bd();
    let Messenger = new msg();
    let util = new utils();

    $('.selectorHora').each(function() {
        $(this).bootstrapMaterialDatePicker({
            format: 'HH:mm',
            date: false,
            shortTime: false,
            switchOnClick: true,
            lang : 'ca',
            clearButton: true,
            cancelText: 'Cancel·lar',
            okText: 'Acceptar',
            clearText: 'Esborrar'
        });
    });
    /*$('#dataNaixement').bootstrapMaterialDatePicker({
        format: 'DD/MM/YYYY',
        time: false,
        lang : 'ca',
        weekStart : 1,
        cancelText: 'Cancel·lar',
        okText: 'Acceptar'
    });*/

    $(".btnDemo").on('click', function (e) {
        let missatge = $(this).attr("data-message");
        Messenger.message(missatge);
    });
    function resetPantallaConfig()
    {
        for (d=1; d<=7; d++) {
            for (h = 1; h <= 4; h++) {
                $("#dia" + d + "-h" + h).val("");
                $("#dia" + d + "-h" + h).removeClass('bg-danger');
            }
        }
    }

    function carregaConfig()
    {
        resetPantallaConfig();
        let conf = bbdd.getConfig();
        if(conf.defined)
        {
            /*$("#dataNaixement").val(conf.dataNaixement);*/
            let horari = conf.horari;
            for (d=0; d < horari.length; d++)
            {
                let dia = d + 1;
                if (horari[d].length)
                {
                    for (t=0; t < horari[d].length; t++)
                    {
                        let ini = horari[d][t][0].length ? horari[d][t][0].join(':') : '';
                        $("#dia" + dia + "-h" + ((t*2)+1)).val(ini);
                        let fi = horari[d][t][1].length ? horari[d][t][1].join(':') : '';
                        $("#dia" + dia + "-h" + ((t*2)+2)).val(fi);
                    }
                }
            }
            loop()
        }
    }

    function validaHores()
    {
        let isCorrect = true;
        for (d=1; d<=7; d++) {
            let tram1 = [];
            let tram2 = [];
            for (h = 1; h <= 4; h++) {
                if (h <= 2) {
                    tram1.push($("#dia" + d + "-h" + h).val());
                } else {
                    tram2.push($("#dia" + d + "-h" + h).val());
                }
            }
            let dia = [];
            if (tram1.length == 2) dia.push(tram1);
            if (tram2.length == 2) dia.push(tram2);

            for (t = 0; t < dia.length; t++) {
                hora1 = dia[t][0];
                hora1 = hora1.split(':');
                hora2 = dia[t][1];
                hora2 = hora2.split(':');
                $("#dia" + d + "-h" + ((t*2)+1)).removeClass('bg-danger');
                $("#dia" + d + "-h" + ((t*2)+2)).removeClass('bg-danger');

                if (Array.isArray(hora1) && Array.isArray(hora2) && hora1.length == 2 && hora2.length == 2) {
                    hora1 = util.getTime(hora1[0], hora1[1]);
                    hora2 = util.getTime(hora2[0], hora2[1]);
                    if (hora1.isAfter(hora2)) {
                        $("#dia" + d + "-h" + ((t*2)+2)).addClass('bg-danger');
                        isCorrect = false;
                    }
                } else {
                    if ((hora1.length == 2 && hora2.length != 2) || (hora1.length != 2 && hora2.length == 2))
                    {
                        $("#dia" + d + "-h" + ((t*2)+1)).addClass('bg-danger');
                        $("#dia" + d + "-h" + ((t*2)+2)).addClass('bg-danger');
                        isCorrect = false;
                    }
                }
            }
            if (!isCorrect) break;
        }
        return isCorrect;
    }

    $(document).ready(function (e) {
        carregaConfig();
        canviaPresentacio();
    });

    function canviaPresentacio()
    {
        if (bbdd.teConfiguracio())
        {
            $("#PresentacioAmbConfiguracio").show();
            $("#PresentacioSenseConfiguracio").hide();
        } else {
            $("#PresentacioAmbConfiguracio").hide();
            $("#PresentacioSenseConfiguracio").show();
        }
    }

    $("#btnExercici").on('click', function(e) { window.open('https://www.youtube.com/results?search_query=exercicis+relaxaci%C3%B3')} );

    $("input[type='checkbox']").on('change', function(e) {
        let dia = $(this).attr("dia");
        if ($(this).is(':checked'))
        {
            let finded = false;
            for (d=1; d<=7; d++) {
                if (d != dia) {
                    for (h = 1; h <= 4; h++) {
                        if ($("#dia" + d + "-h" + h).val())
                        {
                            finded = d;
                        }
                        break;
                    }
                }
                if (finded) break;
            }
            if (finded)
            {
                for (h = 1; h <= 4; h++) {
                    $("#dia" + dia + "-h" + h).val($("#dia" + finded + "-h" + h).val());
                }
            }
        } else {
            for (h = 1; h <= 4; h++) {
                $("#dia" + dia + "-h" + h).val("");
            }
        }
    });

    $(".selectorHora").on("change", function(e) {
        let dia = $(this).attr("dia");
        let hora = $(this).attr("hora");
        let valor = $(this).val();
        $(".selectorHora").each(function() {
            if ($("#dia" + $(this).attr("dia")).is(":checked")) {
                if ($(this).attr("hora") == hora && $(this).val() == "") $(this).val(valor);
            }
        });
    });

    $("#btnBorraConfig").on('click', function (e) {
        bbdd.borraConfiguracio();
        resetPantallaConfig();
        carregaConfig();
        canviaPresentacio();
    });
    $("#btnTancar").on('click', function (e) {
        carregaConfig();
    });
    $("#btnGuardarConfig").on('click', function (e) {
        if (validaHores()) {
            let horari = [];
            for (d = 1; d <= 7; d++) {
                let tram1 = [];
                let tram2 = [];
                for (h = 1; h <= 4; h++) {
                    if (h <= 2) {
                        tram1.push($("#dia" + d + "-h" + h).val().split(':'));
                    } else {
                        tram2.push($("#dia" + d + "-h" + h).val().split(':'));
                    }
                }
                let dia = [];
                if (tram1.length == 2) dia.push(tram1);
                if (tram2.length == 2) dia.push(tram2);

                for (t = 0; t < dia.length; t++) {
                    hora1 = dia[t][0];
                    hora2 = dia[t][1];
                    if (Array.isArray(hora1) && Array.isArray(hora2) && hora1.length == 2 && hora2.length == 2) {
                        hora1 = util.getTime(hora1[0], hora1[1]);
                        hora2 = util.getTime(hora2[0], hora2[1]);
                        if (hora1.isAfter(hora2)) {
                            dia[t][1] = dia[t][0];
                        }
                    }
                }
                horari.push(dia);
            }
            jsonToSave = {
                /*"dataNaixement": $("#dataNaixement").val(),*/
                "horari": horari
            };
            bbdd.guarda(jsonToSave);
            Messenger.setConfig(bbdd.getConfig());
            $('#configModal').modal('toggle');
            carregaConfig();
            canviaPresentacio();
            loop();
        }
    });

    let timeout_loop = false;
    function loop()
    {
        if(timeout_loop !== false) clearTimeout(timeout_loop);
        if(Messenger.hasConfig())
        {
            timeout_loop = setTimeout(function(){
                Messenger.check();
            }, 60000);
        }
    }

</script>

</body>
</html>